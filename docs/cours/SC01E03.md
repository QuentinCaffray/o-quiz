# SC01E03 - Modélisation de base de données

## Menu du jour

- Correction
  - Wireframes
  - Mockups
  - UML Séquence

- Modélisation de base de données
  - Recueil des données
  - MERISE :
    - Modèle conceptuel de données (MCD)
    - Modèle logique de données (MLD)
    - Modèle physique de données (MPD)
      - Dictionnaire de données
      - (UML) Diagramme Entité-Relation

- Architecture (si temps)
  - Spécifications des endpoints
  - Diagramme de séquence (création d'un quiz)

## MERISE 

Merise est une méthodologie complète de gestion de projet (pas seulement pour la BDD). [La preuve](https://pageperso.lis-lab.fr/bernard.espinasse/wp-content/uploads/2021/12/LivreMerisePDF-total-12sept14.pdf).

Côté modélisation de BDD, la méthode Merise offre une approche très complète et précise. Parfois, un peu éloigné de l'industrie (souvent, on fait plus simple !) mais pour le Titre Pro (académique), c'est plutôt adapté.

Merise : un vocabulaire et une articulation de modélisation académique.

MERISE = 
- **MCD** : modèle conceptuel de données
  - objectif : répondre à la question "qu'est-ce qu'on a besoin de stocker dans l'app"
  - technicité : non
  - académique/structuré : oui
  - cible : gestion de projet, pour le commanditaire, pour les investisseurs, pour mamie
- **MLD** : modèle logique de données
  - objectif : répondre à la question "comment on stock les données"
  - technicité : oui
  - étape de traduction du MCD vers une approche SGBD Relationnel
  - on commence à réfléchir à la structure de nos tables et leurs colonnes
  - cible : pour les techos
- **MPD** : modèle physique de données
  - objectif : répondre à la question "stockons les données"
  - implémentation réelle dans un SGBDR cible
    - SQL
    - Modèles via l'ORM
    - export des tables graphique de la BDD
  - cible : pour le SGBD

Deux approches complémentaires à MERISE :
- **Recueil de données**
  - objectif : faire l'inventaire (non structuré) de toutes les données et ce que l'on souhaite stocké
  - sorte de brouillon avant le MCD
- **Dictionnaire de données**
  - objectif : nous aidé à choisir quel SGBDR on utilise et quels types et contraintes pour nos données
  - définir les champs des tables sans pour autant implémenter directement le MPD
  - sorte de tableau qui résume le MPD qu'on implémente dans un second temps


## Types PostgreSQL

```sql
TEXT -- chaine de caractère illimité
VARCHAR(N) -- chaine de caractère limité à N caractères (N = 255 par défaut)
CHAR(N) -- chaine de caractère d'exactement N caractères (N = 255 par défaut)
```


## PostgreSQL

Vocabulaire : 

- `SGBD` = Système de gestion de base**s** de donnée**s**
  - ex : PostgreSQL / MySQL / SQlite / MariaBD

- `SGBDR` = Système de gestion de base de données Relationnel
  - ex : avec des tables

- `BDD` = Base de données
  - ex : `oquiz` / `okanban` / `chenil`

- SGBDR = Serveur = `PostgreSQL`
  - BDD
    - tables
      - enregisterment

- Clients = 
  - `psql` = client terminal (CLI)
  - `pg` = client Node.js
  - `sequelize` = client Node.js (surcouche d'ORM)
  - `pgAdmin` / `DBeaver` / `PostgreSQL` (VSCode) = client graphique (GUI) 
  - `adminer` = client graphique (HTTP)

## Rappel : créer un utilisateur BDD (administrateur) et une BDD

```bash
# Se connecter au serveur PostgreSQL via notre client psql
sudo -i -u postgres psql
psql -U postgres -d postgres

# Lister toutes les BDD existantes
\l 

# Lister tous les utilisateurs BDD
\du

# Lister les tables présentes dans la BDD courante
\dt

# Voir le détail d'une table
\d nom_table

# Connaitre sur quelle base je suis placé
\c

# Créer un utilisateur (admin)
CREATE ROLE oquiz WITH LOGIN PASSWORD 'oquiz';
CREATE USER oquiz WITH PASSWORD 'oquiz';        # (équivalent) Note : (USER) === (ROLE WITH LOGIN)

# Créer une BDD
CREATE DATABASE oquiz WITH OWNER oquiz;

# Se déplacer sur la base oquiz
\c oquiz oquiz

# Autre manière
exit # sortir de psql
psql -U oquiz -d oquiz
```


Faire attention au prompt : 

```bash
# On est dans BASH (terminal)
student@teleporter:$ 

# On est dans PSQL
postgres=#
```

```bash
# Exécuter un script sur une base DEPUIS BASH
psql -U oquiz -d oquiz -f <chemin_du_script.sql>
# Astuce : glisser déposer le fichier dans le terminal pour avoir le chemin ABSOLU
# Sinon, le chemin relatif écrit à la main convient également très bien

# Exécuter un script depuis PSQL sur la base courante
\i <chemin_du_script.sql>
```

## Recap' 

Modélisation de BDD :
- plusieurs méthodes : 
  - MERISE ❤️
  - UML

Démarche : 
- **Recueil de données**
  - faire l'inventaire brouillon des données à stocker
- **MCD**
  - formaliser les données à stocker d'un point de vu conceptuel
- **MLD**
  - traduire le MCD vers une language technique (clé, tables, anglais)
- **Dictionnaire de données**
  - explicite nos types, nos contraintes pour un SGBDR particulier
- **MPD**
  - on implémentate le stockage de données



## Extension VSCode pour visualiser sa BDD

- Installer l'extension VSCode `PostgreSQL (Microsoft)` 
- Se rendre sur l'icone avec le Logo de PostgreSQL (éléphant)
- `Add connection`
  - `Server name` : `localhost`
  - `Username` : `oquiz`
  - `Password` : `oquiz`
  - `Database name` : `oquiz`
  - **Save & Connect**

- Explorer : 
  - `Servers`
    - `localhost, oquiz (oquiz)`
      - `Databases`
        - `oquiz` (clique droit -> `Visualize Schema` ❤️)
          - `Schemas`
            - `public`
              - `tables`  
                - `user` (clique droit -> `Select Top 1000` ❤️)


## Git Flow 

- Ouvrir son dépôt `SC01234-oquiz-PSEUDO` (le votre, pas le mien !)

- `git status`
  - => clean : PUSH
  - => pas clean : COMMIT + PUSH

- `git checkout master`

- `git fetch prof`
- `git reset --hard prof/main`
- `git push --force`

- On oublie pas de créer une branche : 
  - `git checkout -b SC01E03-challenge-modelisation-bdd`
