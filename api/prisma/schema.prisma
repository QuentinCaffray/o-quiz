// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "./generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  member
  author
  admin
}

model User {
  id Int @id @default(autoincrement())

  firstname String
  lastname  String
  email     String @unique()
  password  String

  role Role @default(member)

  refresh_tokens RefreshToken[] // ALIAS User->RefreshToken

  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt // @updatedAt permet d'automatiquement modifier le updated_at lorsque l'enregistrement est modifié

  @@map("user") // Correspondance entre le model "User" (Majuscule) dans le code et la table "user" (minuscule) dans la BDD
}

model Level {
  id Int @id @default(autoincrement())

  name String @unique()

  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  @@map("level")
}

model RefreshToken {
  id Int @id @default(autoincrement())

  token String

  user    User @relation(fields: [user_id], references: [id]) // ALIAS RefreshToken -> User
  //                          ^ clé étrangère         ^ clé primaire
  user_id Int

  issued_at  DateTime @default(now())
  expires_at DateTime

  @@map("refresh_token")
}

model Tag {
  id Int @id @default(autoincrement())

  name String @unique()

  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  @@map("tag")
}

model Quiz {
  id Int @id @default(autoincrement())

  name        String
  description String?

  questions Question[] // Relation 1-N : un quiz a plusieurs questions

  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  @@map("quiz")
}

model Question {
  id Int @id @default(autoincrement())

  description String
  anecdote    String?
  wiki_link   String?

  quiz    Quiz @relation(fields: [quiz_id], references: [id])
  quiz_id Int

  choices Choice[] // Relation 1-N : une question a plusieurs choix

  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  @@map("question")
}

model Choice {
  id Int @id @default(autoincrement())

  description String
  is_valid  Boolean @default(false)

  question    Question @relation(fields: [question_id], references: [id])
  question_id Int

  created_at DateTime @default(now())
  updated_at DateTime @default(now()) @updatedAt

  @@map("choice")
}

